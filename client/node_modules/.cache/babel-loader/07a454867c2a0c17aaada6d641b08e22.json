{"ast":null,"code":"import _slicedToArray from \"/home/kostek/Documents/Programming/angotia-map-creator/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/kostek/Documents/Programming/angotia-map-creator/src/components/partials/creatorPanel/passage/PassageOption.tsx\";\nimport React, { Fragment, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { useSelector, useDispatch } from 'react-redux'; //Import configs\n\nimport creatorConfig from '../../../../assets/configs/creatorConfig.json'; //Import scripts\n\nimport { deepCopy, matrixToIds } from '../../../../assets/scripts/matrix';\nimport { markSquare } from '../../../../assets/scripts/markSquare';\nimport { isEmptyMatrix } from '../../../../assets/scripts/isEmptyMatrix';\nimport { setActionNote } from '../../../../assets/scripts/notifications'; //Import components\n\nimport PassagePopup from './PassagePopup'; //Import actions\n\nimport { changeMapPassageMatrix, changeMapPassageLocations } from '../../../../redux/actions/mapActions';\nvar pressedKey = -1;\ndocument.addEventListener('keydown', function (event) {\n  return pressedKey = event.keyCode;\n});\n\nvar PassageOption = function PassageOption() {\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      isPopup = _useState2[0],\n      setIsPopup = _useState2[1];\n\n  var selectMatrix = deepCopy(useSelector(function (state) {\n    return state.map.select.matrix;\n  }));\n  var passageMatrix = useSelector(function (state) {\n    return state.map.passage.matrix;\n  });\n  var passageLocations = deepCopy(useSelector(function (state) {\n    return state.map.passage.locations;\n  }));\n  var dispatch = useDispatch();\n\n  var passageHandler = function passageHandler() {\n    if (isEmptyMatrix(selectMatrix)) {\n      setActionNote('Need to select fields', 'warning');\n      return;\n    }\n\n    pressedKey === creatorConfig.secondOptionKeyCode ? deletePassage() : setIsPopup(true);\n    setTimeout(function () {\n      return pressedKey = -1;\n    }, 500);\n  };\n\n  var deletePassage = function deletePassage() {\n    var deleteLocations = matrixToIds(selectMatrix);\n    deleteLocations.forEach(function (location) {\n      if (passageLocations.some(function (e) {\n        return e.id === location.id;\n      })) {\n        var index = passageLocations.findIndex(function (x) {\n          return x.id === location.id;\n        });\n        passageLocations.splice(index, 1);\n      }\n    });\n    dispatch(changeMapPassageLocations(passageLocations));\n    markSquare(passageMatrix, 'mapPassageCanvas', changeMapPassageMatrix, 'Passage added', '#fff', '');\n  };\n\n  return React.createElement(Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 58\n    },\n    __self: this\n  }, isPopup ? ReactDOM.createPortal(React.createElement(PassagePopup, {\n    closePopup: setIsPopup,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59\n    },\n    __self: this\n  }), document.body) : null, React.createElement(\"div\", {\n    className: \"passageOption\",\n    onClick: function onClick() {\n      return passageHandler();\n    },\n    \"data-title\": \"add/delete passage\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60\n    },\n    __self: this\n  }));\n};\n\nexport default PassageOption;","map":{"version":3,"sources":["/home/kostek/Documents/Programming/angotia-map-creator/src/components/partials/creatorPanel/passage/PassageOption.tsx"],"names":["React","Fragment","useState","ReactDOM","useSelector","useDispatch","creatorConfig","deepCopy","matrixToIds","markSquare","isEmptyMatrix","setActionNote","PassagePopup","changeMapPassageMatrix","changeMapPassageLocations","pressedKey","document","addEventListener","event","keyCode","PassageOption","isPopup","setIsPopup","selectMatrix","state","map","select","matrix","passageMatrix","passage","passageLocations","locations","dispatch","passageHandler","secondOptionKeyCode","deletePassage","setTimeout","deleteLocations","forEach","location","some","e","id","index","findIndex","x","splice","createPortal","body"],"mappings":"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","sourcesContent":["import React, { Fragment, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { useSelector, useDispatch } from 'react-redux';\n\n//Import configs\nimport creatorConfig from '../../../../assets/configs/creatorConfig.json';\n\n//Import scripts\nimport { deepCopy, matrixToIds } from '../../../../assets/scripts/matrix';\nimport { markSquare } from '../../../../assets/scripts/markSquare';\nimport { isEmptyMatrix } from '../../../../assets/scripts/isEmptyMatrix';\nimport { setActionNote } from '../../../../assets/scripts/notifications';\n\n//Import components\nimport PassagePopup from './PassagePopup';\n\n//Import actions\nimport { changeMapPassageMatrix, changeMapPassageLocations } from '../../../../redux/actions/mapActions';\n\n\nlet pressedKey: number = -1;\ndocument.addEventListener('keydown', event => pressedKey = event.keyCode);\n\nconst PassageOption: React.FC = () => {\n    const [isPopup, setIsPopup] = useState<Boolean>(false);\n    const selectMatrix = deepCopy(useSelector(state => state.map.select.matrix));\n    const passageMatrix = useSelector(state => state.map.passage.matrix);\n    let passageLocations = deepCopy(useSelector(state => state.map.passage.locations));\n    const dispatch = useDispatch(); \n\n    const passageHandler = () => {\n        if (isEmptyMatrix(selectMatrix)) {\n            setActionNote('Need to select fields', 'warning');\n            return;\n        }\n\n        pressedKey === creatorConfig.secondOptionKeyCode ? deletePassage() : setIsPopup(true);\n\n        setTimeout(() => pressedKey = -1, 500) \n    }\n    \n    const deletePassage = () => {\n        const deleteLocations = matrixToIds(selectMatrix);\n\n        deleteLocations.forEach(location => {\n            if (passageLocations.some(e => e.id === location.id)) {\n                const index = passageLocations.findIndex(x => x.id === location.id);\n\n                passageLocations.splice(index, 1);\n              }\n        })\n\n        dispatch(changeMapPassageLocations(passageLocations));\n        markSquare(passageMatrix, 'mapPassageCanvas', changeMapPassageMatrix, 'Passage added', '#fff', '')\n    }\n\n    return (\n        <Fragment>\n            { isPopup ? ReactDOM.createPortal(<PassagePopup closePopup={setIsPopup}/>, document.body) : null}\n            <div className=\"passageOption\" onClick={() => passageHandler()} data-title=\"add/delete passage\"></div>\n        </Fragment>\n    )\n}\n\n\nexport default PassageOption;"]},"metadata":{},"sourceType":"module"}